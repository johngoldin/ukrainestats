---
title: "ukrainestats"
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

```{r libraries}
library(tidyverse)
library(glue)
library(xml2)
library(curl)
```


```{r functions}
# using: https://www.scrapingdog.com/blog/web-scraping-r/
# link <- "https://www.mil.gov.ua/en/news/2023/03/08/the-total-combat-losses-of-the-enemy-from-24-02-2022-to-08-03-2023/"
# page = read_html(link, as_html = FALSE)
# lines <- read_html(link)

extract_number  <-  function(text, phrase = "(?<=personnel [‒-] about )\\d*") {
  # x <- str_extract(text, "(?<=personnel [‒-] about )\\d*")
  x <- str_extract(text, phrase)
  if (is.na(x)) {
    if (!str_detect(text, phrase)) stop(paste0(phrase, " not found"))
    warning(paste0("number not found:", text()))
  }
  as.numeric(x)
}

create_mod_link <- function(adate) {
  if (!is.Date(adate)) adate <- as_date(adate)
  # must have this form:   (4 digit years)
  # https://www.mil.gov.ua/en/news/2023/03/08/the-total-combat-losses-of-the-enemy-from-24-02-2022-to-08-03-2023/
  if (adate >= as_date("2023-03-03")) link <- glue("https://www.mil.gov.ua/en/news/", format(adate, "%Y/%m/%d"), "/the-total-combat-losses-of-the-enemy-from-24-02-2022-to-", format(adate, "%d-%m-%Y"), "/")
  else if (adate >= as_date("2023-01-01")) link <- glue("https://www.mil.gov.ua/en/news/", format(adate, "%Y/%m/%d"), "/the-total-combat-losses-of-the-enemy-from-24-02-22-to-", format(adate, "%d-%m-%y"), "/")
  else link <- glue("https://www.mil.gov.ua/en/news/", format(adate, "%Y/%m/%d"), "/the-total-combat-losses-of-the-enemy-from-24-02-to-", format(adate, "%d-%m"), "/")
  link
}

fetch_mod_text <- function(adate) {
  if (!is.Date(adate)) adate <- as_date(adate)
  if (adate < ymd("2022-04-12")) return(NA_character_)
  if (adate > today()) return(NA_character_)

  link <- create_mod_link(adate)
  x <- read_lines(link)
  #the_line <- x[x |> str_detect("personnel ‒ about")]
  # the_line <- x[x |> str_detect("The total combat losses of the enemy from")]
  if (adate <= ymd("2022-04-16")) the_line <- x[str_detect(x, "personnel ‒ about")]
  if (adate > ymd("2022-04-16")) the_line <- x[str_detect(x, "persons were liquidated")]
  if (length(the_line) == 0) {
    warning(paste0("Info line not found for ", adate))
    return(NA_character_)
  }
  if (length(the_line) > 1) {
     warning(paste0("More than one line found ", adate, "\n", link))
    return(NA_character_)
  }
  if (adate <= as_date("2022-04-16")) first_line <- which(str_detect(x, "personnel ‒ about"))
  if (adate > as_date("2022-04-16"))  first_line <- which(str_detect(x, "persons were liquidated"))
  last_line <- which(str_detect(x, "special equipment"))
  if (is.na(last_line) || (length(last_line) == 0)) stop(paste(adate, " special equipment line note found"))
  # the_line
  str_flatten(c(as.character(adate), x[first_line:last_line]))
}


# x |> str_extract("personnel ‒ about \\[digit]*")
# the_line <- x[x |> str_detect("personnel ‒ about")]
# 
# str_extract(the_line, "(?<=personnel ‒ about )\\d*")
# 
# 
# 
# n <-  extract_number(the_line, "personnel ‒ about ")
```
April 12, 2022 is earliest Russian casualty count

Some dates that are missing data: "2022-06-16", "2022-06-18"

at this point doing two digit date for start of war and end
https://www.mil.gov.ua/en/news/2023/02/23/the-total-combat-losses-of-the-enemy-from-24-02-22-to-23-02-23/

back then two digit years
https://www.mil.gov.ua/en/news/2022/12/16/the-total-combat-losses-of-the-enemy-from-24-02-to-16-12/

https://www.mil.gov.ua/en/news/2022/12/31/the-total-combat-losses-of-the-enemy-from-24-02-to-31-12/

3/3/2023 seems to be start of using 4-digit year

wrong:
https://www.mil.gov.ua/en/news/2022/09/23/the-total-combat-losses-of-the-enemy-from-24-02-to-23-09/

On January 1, started doing two digit dates
https://www.mil.gov.ua/en/news/2023/01/03/the-total-combat-losses-of-the-enemy-from-24-02-22-to-03-01-23/

works
https://www.mil.gov.ua/en/news/2023/02/20/the-total-combat-losses-of-the-enemy-from-24-02-22-to-20-02-23/

does not work:
https://www.mil.gov.ua/en/news/23/02/23/the-total-combat-losses-of-the-enemy-from-24-02-22-to-23-02-23/

does note work:
https://www.mil.gov.ua/en/news/23/02/20/the-total-combat-losses-of-the-enemy-from-24-02-22-to-20-02-23/

works:
https://www.mil.gov.ua/en/news/2022/05/09/the-total-combat-losses-of-the-enemy-from-24-02-to-09-05/

works:
https://www.mil.gov.ua/en/news/2022/06/25/the-total-combat-losses-of-the-enemy-from-24-02-to-25-06/

works:
https://www.mil.gov.ua/en/news/2022/04/16/the-total-combat-losses-of-the-enemy-from-24-02-to-16-04/

first phrase changed between 2022-04-16 and 2022-04-17
"personnel ‒ about" to 


wrong:
https://www.mil.gov.ua/en/news/2022/07/12/the-total-combat-losses-of-the-enemy-from-24-02-to-12-07/

wrong:
https://www.mil.gov.ua/en/news/2022/06/20/the-total-combat-losses-of-the-enemy-from-24-02-to-20-06/
```{r}

the_dates <-  seq(from = ymd("2022-04-15"), to = ymd("2023-02-15"), by = "1 month") %m+% days(3) # add 3 days to get the 15th of each month
the_dates <- the_dates[!(the_dates %in% uk_df$date)]

abunch <- map_chr(the_dates, fetch_mod_text, .progress = TRUE)
abunch <- abunch[!is.na(abunch)]


if (length(abunch > 0)) {
  uk_additions <- tibble(report = abunch, date = ymd(str_sub(report, start = 1, end = 10)))
}
uktest <- bind_rows(uk_df, uk_additions)

uk_df$personnel = map_dbl(uk_df$report, extract_number, phrase = "(?<=personnel [‒-] about )\\d*" )
uk_df$tanks = map_dbl(uk_df$report, extract_number, phrase = "(?<=tanks [‒-] )\\d*" )
uk_df$APV = map_dbl(uk_df$report, extract_number, phrase = "(?<=APV [‒-] )\\d*" )
uk_df$artillery = map_dbl(uk_df$report, extract_number, phrase = "(?<=artillery systems [‒-–] )\\d*" )
uk_df$mlrs = map_dbl(uk_df$report, extract_number, phrase = "(?<=MLRS [‒-–-] )\\d*" )

```

2022-04-29<p>personnel ‒ about 23000 (+200) persons were liquidated,</p><p>tanks ‒ 986 (+16),</p><p>APV ‒ 2418 (+29),</p><p>artillery systems – 435 (+4),</p><p>MLRS ‒ 151 (+0),</p><p>Anti-aircraft warfare systems ‒ 73 (+1),</p><p>aircraft – 189 (+2),</p><p>helicopters – 155 (+0),</p><p>vehicles ‒ 1695 (+7),</p><p>boats / cutters ‒ 8 (+0),</p><p>fuel tanks ‒ 76 (+0),</p><p>UAV operational-tactical level ‒ 229 (+14).</p><p>special equipment ‒ 31 (+0).</p>

2022-05-29<p>personnel - about 30150 (+150) persons were liquidated,</p><p>tanks ‒ 1338 (+8) од,</p><p>APV ‒ 3270 (+12) од,</p><p>artillery systems – 631 (+3) од,</p><p>MLRS - 203 (+0) од,</p><p>Anti-aircraft warfare systems - 93 (+0) од,</p><p>aircraft – 207 (+0) од,</p><p>helicopters – 174 (+0) од,</p><p>UAV operational-tactical level - 504 (+1),</p><p>cruise missiles - 116 (+0),</p><p>warships / boats - 13 (+0) од,</p><p>vehicles and fuel tanks - 2240 (+14) од,</p><p>special equipment - 48 (+0).</p>

2022-09-29<p class=\"justifyfull\">personnel ‒ about 58580 (+430) persons were liquidated,</p><p class=\"justifyfull\">tanks ‒ 2325 (+13),</p><p class=\"justifyfull\">APV ‒ 4909(+20),</p><p class=\"justifyfull\">artillery systems – 1385 (+4),</p><p class=\"justifyfull\">MLRS – 331 (+0) од,</p><p class=\"justifyfull\">Anti-aircraft warfare systems ‒ 175 (+0),</p><p class=\"justifyfull\">aircraft – 262 (+0),</p><p class=\"justifyfull\">helicopters – 224 (+0),</p><p class=\"justifyfull\">UAV operational-tactical level – 995 (+6),</p><p class=\"justifyfull\">cruise missiles ‒ 246 (+4),</p><p class=\"justifyfull\">warships / boats ‒ 15 (+0),</p><p class=\"justifyfull\">vehicles and fuel tanks – 3751 (+9),</p><p class=\"justifyfull\">special equipment ‒ 131 (+0).</p>
